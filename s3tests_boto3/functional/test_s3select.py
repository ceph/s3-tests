import nose
import random
import string
import re
from nose.plugins.attrib import attr
from botocore.exceptions import ClientError
from nose.plugins.skip import SkipTest

import uuid
from nose.tools import eq_ as eq

from . import (
    get_client
    )


import logging
logging.basicConfig(level=logging.INFO)

region_name = ''

################################## start of encoded parquet
import base64

encoded_parquet = b'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ADot6E0HBADMjbAASA2IAEktsACMjeAAylF4DVAADQ24ALktGADOLQAAHi1QAMwtcAC+LVgAAQ0oAOaN2AD7LSAAbi0IAJ4t4ADmDYgAtA04APINEABFTdgAUi1wAMANIABDDVgAbi04AAkN0QBiDQgALQ1wANttYABIDXAAZk1IAG8N0AB4DSgARw3oAMoNoABALYAA2w1wAM8NQABGDXAAoS2QAJkNcACATYgA4w0QAF8NWABfLVAAdm2YBOAOCTkAfC2YAI0NMAAADfAAVU0oPFIjAAAAAAAAchkAAAAAAAAVABXYExXiEywV0A8VBBUGFQYcGAgKJwAAAAAAABgICgAAAAAAAAAWACgICicAAAAAAAAYCAoAAAAAAAAAAAAA7An06wQDAAAA0A8BCn8ABCDAAAQUYMABCCSgwAIMNODAAxBEIMEEFFRgwQUYZKDBBhx04MEHIIQgwggklGDCCSikoMIKLLTgwgswxCDDDDTUYMMNOOSgww489ODDD0AEIcQQRBRhxBFIJKHEEkw04cQTUEQhxRRUVGHFFVhkocUWXGzRhRdfgBGGGGOQUYYZZ6CRhhprsNGGG2/AEYccc9BRhx134JGHHnvw0YcffwASiCCDEFKIIYcgkogiizDSiCOPQBKJJJNQUokll2CSiSabcNKJJ5+AEoooo5BSiimnoJKKKquw0oorr8ASiyyz0FKLLbfgkosuu/DSiy+/ABOMMMMQU4wxxyCTjDLLMNOMM89AE40001BTjTXXYJONNttw040334ATjjjjkFOOOeegk44667DTjjvvwBOPPPPQU4899+CTjz778NOPP/8AFJBAAxFUkEEHIZSQQgsx1JBDD0EUkUQTUVSRRRdhlJFGG3HUkUcfgRSSSCORpEZJJp2EUkoqrcQSBS259BJMMck0E0012XQTTjnptBNPPfn0E1BBCTUUUUUZdRRSSfWi1FJMNeXUU1BFJdVUVFVl1VVYZaXVVlx15dVXYIUl1lhklWXWWWilpdZabLXl1ltwxSXXXHTVZdddeOWl11589eXXX4AFJthghBVm2GGIJabYYow15lhhj0EWmWSTUVaZZZdhlplmm3HWmWefgRaaaKORVpppp6GWmmqrsdaaa6/BFptss9FWm2234Zabbrvx1ptvvwEXnHDDEZdRccYdh1xyyi3HnDfNOfccdNFJNx111dFl3XXYZafddtx15x0u34EXnnjjkedPeeadh1566oG3Hnt97bn3HnzxyQfYfPTVZ999+OWn33789efffwAGKOCABBZo4EAHIlhRggouyGCDDj4IYRkuRSjhHxNSWKGFF2KYoYYbctihhx+CGKKII5JYooknqoFiiiquyGKLLr4IY4wyzkhjjTbeiGOOOu7IY48+/ghkkEIOSWSRYxlpxJFIJkmVkksy2aSTT0IZpZRTUlmllVdimaWWW3LZpZdfghmmmGOSWaaZZ6KZpgFqrslmeW26+Saccco5J5112nknnnmGpKdvBe3JZ5//CeDnn4AGKuighGZRqKHDHIpoooouymijjpb5KKSRSjoppZVaeimmmWq6KaedevopqKGKOiqppZp6Kqqpqroqq626+iqsscoa46y01mrrrbjmqutsu/Laq6+/AhussMMSW6yxx36FbLLKLstss84+C2200no2LbXVWnstttlquy233Xr7LbighCvuuOSWa+656Kar7rrstuvuu2aaCG+88s5LL631qmfvvenhm6+++/Lbr7//AhywwAMTbE/BBh+McCYJK7wwww07/DDEEUs8McXnVmzxxX9hnLHGG3PcsccfgxyyyJuMTHLJJp+cGyQop6zyyiyT07LLL8Mcs8wz01yzzTfjnLPOO/Pcczc+/wx00EIPTXTRRh+NdNJKL810006v8zTUUT8h9dRUV2311VhnrfXWXHethNdfgx222GNbSXbZZktwNtoepa322sSw3bYnbr+NzApwxy333HTXbffdeOet9958u9m3338DHrjggxNeuOGHI5644oszTkLjjj8OeeSST14Ms5RXbvnlmGeu+eacd+7556CHLvropJdu+ukmyFAcFQQZNQQABhkYAWEVAhbQDxb6iQEWwFAm5jsmCBwYCAonAAAAAAAAGAgKAAAAAAAAABYAKAgKJwAAAAAAABgICgAAAAAAAAAAGSwVBBUEFQIAFQAVBBUCAAAAFQQVsHYViDxMFeYOFQQSAACYOwhLIAAFAQQmDgUHCACaIQkIBGYLCQgEHxUJCARlEwkIABcNGASrEgkQBHkfCQgAZA0IACcNSAAeDUgEHQwJIAScHAkIBGgECQgAqw0oBM0iCRAEvAEJCARZJQkIAE4NCAQRCQkQAJENKATREQkQACQNuATKHgkQBNoQCQgE+xoJCAQX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LC0wAJZNEAC5LdgArg1gANsNOABibYAAHI1oAAItEABtDaAAuQ1YAOVtaAAgDcAA+Q1gDQ8EALZNoACJDZgAry0QAIwNWACjLaAAww3oAIQNeADeDZAAQC0gAFANODzpHQAAAAAAAOYmAAAAAAAAFQAV2BMV4hMsFdAPFQQVBhUGHBgICicAAAAAAAAYCAcAAAAAAAAAFgAoCAonAAAAAAAAGAgHAAAAAAAAAAAAAOwJ9OsEAwAAANAPAQp/AAQgwAAEFGDAAQgkoMACDDTgwAMQRCDBBBRUYMEFGGSgwQYcdODBByCEIMIIJJRgwgkopKDCCiy04MILMMQgwww01GDDDTjkoMMOPPTgww9ABCHEEEQUYcQRSCShxBJMNOHEE1CcEIUUU1BRhRVXYJGFFltw0YUXX4BhRBhijEFGGWacgUYaaqzBRhtuvAFHHHLMQUcddtyBRx567MFHH378AUggggyiAiGFGHIIIokosggjjTjyCCSRSDIJJZVYcgkmmWiyCSedePIJKKGIMgoppZjCwClloJKKKquw0oorr8ASiyyz0FKLLbfgkosuu/DSiy+/ABOMMMMQU4wxxyCTjDLLMNOMM89AE40001BTjTXXYJONNttw040334ATjjjjkFOOOeegk44667DTjjvvwBOPPPPQU4899+CTjz778NOPP/8AFJBAAxFUkEEHIZSQQgsx1JBDD0EUkUQTUVSRRRdhlJFGG3HUkUcfgRSSSCORVJJJJ+WCUkoqrcRSSy69BFNMMs1EU0023YRTTjp9shNPPfn0E1BBCTUUUUUZdRRSSSm1FFNNOfUUVFFJNRVVVVl1FVZZabUVV1159RVYYYk1FlllmXUWWmmptRZbbbn1FlxqxCXXXHTVZdddeOWl11589eXXX4AFJthghBVm2GGIJabYYow15thjkEUm2WSUVWbZZZhlptlmnHXm2WeghSbaaKSVZtppqKWm2mqstebaa7DFJttstNVm22245abbbrz15ttvwAUn3HDEFWfcccglp9xyzDXn3HPQtRGddNNRV51112GXnXbbcdedd9+BF55445FXnnnnoZeeeuux1557fe/BF59889FXn3334Zeffvvxt0B//v0HYIACDkggQQUaeCCCCSq4IIMNOvigFxBG2JSEE1JoQoUWXohhhlJpuCGHHXr4IYghijgiiSWaeCKKKaq4IostuvjieTDGeJ+MM9JYo4034pijjjvKxWOPPv4IZJBCDklkkUYeiWSSSi7JZJNOPglllFJOSWWVVl6JZZZabslll15+CWaYYo6JFZllmnkmmmmquaYQbLbp5ptwxinnnHTWaeedeOap55589unnn4AGKuighBZq6KGIJqrooow26uijkEYq6aSUVmrppZhmqummnHbq6aegnvRWqKKOSuoupZp6KqqpIqDqqqy26uqrsMZaYXqyzkprrbbeimuuuu7KKzG9+vorsMEKOyyxxRp7LLLJKrsss806+yy00V4m7bTUVmvttdhmq+223Harl7ffghuuuOOSW66556Kbrrrrstuuu+/CG6+889Jbr7334jtnvvruy2+/svn77yUAByzwwAQXbPDBCCes8MIMN+zwwxBHLPHEFFds8cUYQ5WxxixtrBrHHXv8McghizwyySWbfDLKKau86Mosm9Oyyy/DHLPMM9Ncs80345yzzlzGvDPPPfv8M9BBCz000UUbfTTSSSu9NNNNO/001FFLPTXVVVvN8tVYZ6311hRw3bXXX4OdSthij0122WafjXbaaq/Ndttuvw133HLPTXfddt+Nd956781333578TdZgLMTuOCD34Yc4YUbnt7hiCeu+OKMN+7445BHLvnklJv7Q+WWX4555pqftjnnnXv+Oeihi47l6KSXbvrpqKeuegirs96666/DHrvsJpCjARwVBBk1BAAGGRgBYhUCFtAPFqqLARaMUSaujgEmhFIcGAgKJwAAAAAAABgIBwAAAAAAAAAWACgICicAAAAAAAAYCAcAAAAAAAAAABksFQQVBBUCABUAFQQVAgAAABUEFYB3Fbw8TBXwDhUEEgAAwDsIOAEABQEEoRUFBwgAShIJCARcHgkIBBUYCQgEFggJCASEBQkIBIEgCQgAowkHBACQDUAA5g1AADgNQADlDSgE7RsJKQQ1BwkIAKkNGABSDTAEBA4JGACYDSAE+hoJEABlDVgEfRMJEAAUDQgEugYJEABnDTAEdhkJEAApDVgEog0JEABSDRAAZQ0oAHMNKARiHwkgAHINSAQLEQkQACQNMACODWgAXQ24ALoN0AD9DSgA7w0YALAtEAQKAwlAAHgNQASiIgkQAIwNeACADXAE+wIJGABREVANOATdHAkYBO0JCQgAnS0QBHkXCRAEwwoJCAA4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OC04AAAtADy4IgAAAAAAAAwdAAAAAAAAFQAV2BMV4hMsFdAPFQQVBhUGHBgIAScAAAAAAAAYCBEAAAAAAAAAFgAoCAEnAAAAAAAAGAgRAAAAAAAAAAAAAOwJ9OsEAwAAANAPAQp/AAQgwAAEFGDAAQgkoMACDDTgwAMQRCDBBBRUYMEFGGSgwQYcdODBByCEIMIIJJRgwgkopKDCCiy04MILMMQgwww01GDDDTjkoMMOPPTgww9ABCHEEEQUYcQRSCShxBJMNOHEE1BEIcUUVFRhxRVYZKHFFlx04cUXYIQhxhhklGHGGWikocYabLThxhtwxCHHHHTUYccdeOShxx589OHHH4AEIsgghBRiyCGIJKLIIow04sgjkEQiySSUVGLJJZhkoskmnHTiySeghCLKKKSUYsopqKSiyiqstOLKK7DEIssstNRiyy245KLLLgfw0osvvwATjDDDEFOMMccgk4wyyzDTjDPPQBONNNNQU40112CTjTbbcNONN9+AE44445BTjjnnOIBOOuqsw0477rwDTzzyzENPPfbcg08++uzDTz/+/ANQQAINRFBBBh2EUEIKLcRQQw49BFFEEk1EUUUWXYRRRhptxJErHXn0EUghiTQSSSWZdBJKKam0EkstuRTQMpK8BFNMMs1EU0023YRTTjrtxFNPPv0EVFACCDUUUUUZdRRSSSm1FFNNOfUUVFFJNRVVVVl1FVZZabUVV1159RVYYYk1FlllmXUWWmmptRZbbbn1FlxxyTUXXXXZdRdeeem1F199+fUXYIEJNhhhhRl2GGKJKbYYY4059hhkkUk2GWWVWXYZZplpFtlmnHXm2WeghSbaaKShVZppp6GWmmqrsdaaa6/BFptss9FWm2234Zabbrupw1tvvv0GXHDCDUdcccYdh1xyyi3HXHPOPQdddNJNR1111l2HXXbabcddd959Nw144Yk3HnnlmXceeumptx57fe1149578PEQn3zz0ZdPfYTYdx9++em3H3/9+fcfgAEKOCCBBRp4IIIJKrgggw06+CCEEUo4IYUVWnghhhlquCGHHXr4IQkghijiiCSWaOKJKOKEV4rUqbgiiy26+CKMMco4I4012ngjjjnquCOPPcbn449ABinkkEQWaaSJR1KBZJJKLslkk04+CWWUUhY5JZVVWnkllllquSWXXYbi5ZdghinmmGQK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lgR7ImluZGV4X2NvbHVtbnMiOiBbXSwgImNvbHVtbl9pbmRleGVzIjogW10sICJjb2x1bW5zIjogW3sibmFtZSI6ICJhIiwgImZpZWxkX25hbWUiOiAiYSIsICJwYW5kYXNfdHlwZSI6ICJpbnQ2NCIsICJudW1weV90eXBlIjogImludDY0IiwgIm1ldGFkYXRhIjogbnVsbH0sIHsibmFtZSI6ICJiIiwgImZpZWxkX25hbWUiOiAiYiIsICJwYW5kYXNfdHlwZSI6ICJpbnQ2NCIsICJudW1weV90eXBlIjogImludDY0IiwgIm1ldGFkYXRhIjogbnVsbH0sIHsibmFtZSI6ICJjIiwgImZpZWxkX25hbWUiOiAiYyIsICJwYW5kYXNfdHlwZSI6ICJpbnQ2NCIsICJudW1weV90eXBlIjogImludDY0IiwgIm1ldGFkYXRhIjogbnVsbH0sIHsibmFtZSI6ICJkIiwgImZpZWxkX25hbWUiOiAiZCIsICJwYW5kYXNfdHlwZSI6ICJpbnQ2NCIsICJudW1weV90eXBlIjogImludDY0IiwgIm1ldGFkYXRhIjogbnVsbH1dLCAiY3JlYXRvciI6IHsibGlicmFyeSI6ICJweWFycm93IiwgInZlcnNpb24iOiAiMi4wLjAifSwgInBhbmRhc192ZXJzaW9uIjogIjEuMi40In0AGAxBUlJPVzpzY2hlbWEYgAkvLy8vLzFnREFBQVFBQUFBQUFBS0FBNEFCZ0FGQUFnQUNnQUFBQUFCQkFBUUFBQUFBQUFLQUF3QUFBQUVBQWdBQ2dBQUFFd0NBQUFFQUFBQUFRQUFBQXdBQUFBSUFBd0FCQUFJQUFnQUFBQUlBQUFBRUFBQUFBWUFBQUJ3WVc1a1lYTUFBQllDQUFCN0ltbHVaR1Y0WDJOdmJIVnRibk1pT2lCYlhTd2dJbU52YkhWdGJsOXBibVJsZUdWeklqb2dXMTBzSUNKamIyeDFiVzV6SWpvZ1czc2libUZ0WlNJNklDSmhJaXdnSW1acFpXeGtYMjVoYldVaU9pQWlZU0lzSUNKd1lXNWtZWE5mZEhsd1pTSTZJQ0pwYm5RMk5DSXNJQ0p1ZFcxd2VWOTBlWEJsSWpvZ0ltbHVkRFkwSWl3Z0ltMWxkR0ZrWVhSaElqb2diblZzYkgwc0lIc2libUZ0WlNJNklDSmlJaXdnSW1acFpXeGtYMjVoYldVaU9pQWlZaUlzSUNKd1lXNWtZWE5mZEhsd1pTSTZJQ0pwYm5RMk5DSXNJQ0p1ZFcxd2VWOTBlWEJsSWpvZ0ltbHVkRFkwSWl3Z0ltMWxkR0ZrWVhSaElqb2diblZzYkgwc0lIc2libUZ0WlNJNklDSmpJaXdnSW1acFpXeGtYMjVoYldVaU9pQWlZeUlzSUNKd1lXNWtZWE5mZEhsd1pTSTZJQ0pwYm5RMk5DSXNJQ0p1ZFcxd2VWOTBlWEJsSWpvZ0ltbHVkRFkwSWl3Z0ltMWxkR0ZrWVhSaElqb2diblZzYkgwc0lIc2libUZ0WlNJNklDSmtJaXdnSW1acFpXeGtYMjVoYldVaU9pQWlaQ0lzSUNKd1lXNWtZWE5mZEhsd1pTSTZJQ0pwYm5RMk5DSXNJQ0p1ZFcxd2VWOTBlWEJsSWpvZ0ltbHVkRFkwSWl3Z0ltMWxkR0ZrWVhSaElqb2diblZzYkgxZExDQWlZM0psWVhSdmNpSTZJSHNpYkdsaWNtRnllU0k2SUNKd2VXRnljbTkzSWl3Z0luWmxjbk5wYjI0aU9pQWlNaTR3TGpBaWZTd2dJbkJoYm1SaGMxOTJaWEp6YVc5dUlqb2dJakV1TWk0MEluMEFBQVFBQUFDa0FBQUFaQUFBQURRQUFBQUVBQUFBZlAvLy93QUFBUUlRQUFBQUZBQUFBQVFBQUFBQUFBQUFBUUFBQUdRQUFBQnMvLy8vQUFBQUFVQUFBQUNvLy8vL0FBQUJBaEFBQUFBVUFBQUFCQUFBQUFBQUFBQUJBQUFBWXdBQUFKai8vLzhBQUFBQlFBQUFBTlQvLy84QUFBRUNFQUFBQUJRQUFBQUVBQUFBQUFBQUFBRUFBQUJpQUFBQXhQLy8vd0FBQUFGQUFBQUFFQUFVQUFnQUJnQUhBQXdBQUFBUUFCQUFBQUFBQUFFQ0VBQUFBQndBQUFBRUFBQUFBQUFBQUFFQUFBQmhBQUFBQ0FBTUFBZ0FCd0FJQUFBQUFBQUFBVUFBQUFBQUFBQUEAGCJwYXJxdWV0LWNwcCB2ZXJzaW9uIDEuNS4xLVNOQVBTSE9UGUwcAAAcAAAcAAAcAAAAtQgAAFBBUjE='


################################## end of encoded parquet

# recurssion function for generating arithmetical expression 
def random_expr(depth):
    # depth is the complexity of expression 
    if depth==1 :
        return str(int(random.random() * 100) + 1)+".0"
    return '(' + random_expr(depth-1) + random.choice(['+','-','*','/']) + random_expr(depth-1) + ')'


def generate_s3select_where_clause(bucket_name,obj_name):

    a=random_expr(4)
    b=random_expr(4)
    s=random.choice([ '<','>','=','<=','>=','!=' ])

    try:
        eval( a )
        eval( b )
    except ZeroDivisionError:
        return

    # generate s3select statement using generated randome expression
    # upon count(0)>0 it means true for the where clause expression
    # the python-engine {eval( conditional expression )} should return same boolean result.
    s3select_stmt =  "select count(0) from s3object where " + a + s + b + ";"

    res = remove_xml_tags_from_result( run_s3select(bucket_name,obj_name,s3select_stmt) ).replace(",","")

    if  s == '=':
        s = '=='

    s3select_assert_result(int(res)>0 , eval( a + s + b ))

def generate_s3select_expression_projection(bucket_name,obj_name):

        # generate s3select statement using generated randome expression
        # statement return an arithmetical result for the generated expression.
        # the same expression is evaluated by python-engine, result should be close enough(Epsilon)
        
        e = random_expr( 4 )

        try:
            eval( e )
        except ZeroDivisionError:
            return

        if eval( e ) == 0:
            return

        res = remove_xml_tags_from_result( run_s3select(bucket_name,obj_name,"select " + e + " from s3object;",) ).replace(",","")

        # accuracy level 
        epsilon = float(0.000001) 

        # both results should be close (epsilon)
        assert (1 - (float(res.split("\n")[1]) / eval( e )) ) < epsilon

@attr('s3select')
def get_random_string():

    return uuid.uuid4().hex[:6].upper()

@attr('s3select')
def test_load_parquet_object():

        parquet_obj_name = "4col.parquet"
        bucket_name = "test"
        decode_parquet = base64.b64decode(encoded_parquet)
        upload_csv_object(bucket_name,parquet_obj_name,decode_parquet)

        parquet_magic_header = getobj_range_req(bucket_name,parquet_obj_name,'bytes=0-4')

        b_to_s = parquet_magic_header[0]+parquet_magic_header[1]+parquet_magic_header[2]+parquet_magic_header[3]
        if (b_to_s != 'PAR1' and b_to_s != 'PARE'):
            assert False, "parquet_magic_header ="+parquet_magic_header+ " parquet_magic_footer ="+parquet_magic_footer

        parquet_magic_footer = getobj_range_req(bucket_name,parquet_obj_name,'bytes=23362-23366')

        b_to_s = parquet_magic_footer[0]+parquet_magic_footer[1]+parquet_magic_footer[2]+parquet_magic_footer[3]
        if (b_to_s != 'PAR1' and b_to_s != 'PARE'):
            assert False, "parquet_magic_header ="+parquet_magic_header+ " parquet_magic_footer ="+parquet_magic_footer

@attr('s3select')
def test_generate_where_clause():

    # create small csv file for testing the random expressions
    single_line_csv = create_random_csv_object(1,1)
    bucket_name = "test"
    obj_name = get_random_string() #"single_line_csv.csv"
    upload_csv_object(bucket_name,obj_name,single_line_csv)
       
    for _ in range(100): 
        generate_s3select_where_clause(bucket_name,obj_name)

@attr('s3select')
def test_generate_projection():

    # create small csv file for testing the random expressions
    single_line_csv = create_random_csv_object(1,1)
    bucket_name = "test"
    obj_name = get_random_string() #"single_line_csv.csv"
    upload_csv_object(bucket_name,obj_name,single_line_csv)
       
    for _ in range(100): 
        generate_s3select_expression_projection(bucket_name,obj_name)

def s3select_assert_result(a,b):
    if type(a) == str:
        a_strip = a.strip()
        b_strip = b.strip()
        assert a_strip != ""
        assert b_strip != ""
    else:
        assert a != ""
        assert b != ""
    
    nose.tools.assert_equal(a,b)

def create_csv_object_for_datetime(rows,columns):
        result = ""
        for _ in range(rows):
            row = ""
            for _ in range(columns):
                row = row + "{}{:02d}{:02d}T{:02d}{:02d}{:02d}Z,".format(random.randint(0,100)+1900,random.randint(1,12),random.randint(1,28),random.randint(0,23),random.randint(0,59),random.randint(0,59),)
            result += row + "\n"

        return result

def create_random_csv_object(rows,columns,col_delim=",",record_delim="\n",csv_schema=""):
        result = ""
        if len(csv_schema)>0 :
            result = csv_schema + record_delim

        for _ in range(rows):
            row = ""
            for _ in range(columns):
                row = row + "{}{}".format(random.randint(0,1000),col_delim)
            result += row + record_delim

        return result

def create_random_csv_object_string(rows,columns,col_delim=",",record_delim="\n",csv_schema=""):
        result = ""
        if len(csv_schema)>0 :
            result = csv_schema + record_delim

        for _ in range(rows):
            row = ""
            for _ in range(columns):
                if random.randint(0,9) == 5:
                    row = row + "{}{}".format(''.join(random.choice(string.ascii_letters) for m in range(10)) + "aeiou",col_delim)
                else:
                    row = row + "{}{}".format(''.join("cbcd" + random.choice(string.ascii_letters) for m in range(10)) + "vwxyzzvwxyz" ,col_delim)
                
            result += row + record_delim

        return result

def create_random_csv_object_trim(rows,columns,col_delim=",",record_delim="\n",csv_schema=""):
        result = ""
        if len(csv_schema)>0 :
            result = csv_schema + record_delim

        for _ in range(rows):
            row = ""
            for _ in range(columns):
                if random.randint(0,5) == 2:
                    row = row + "{}{}".format(''.join("   aeiou    ") ,col_delim)
                else:
                    row = row + "{}{}".format(''.join("abcd") ,col_delim)


                
            result += row + record_delim

        return result

def create_random_csv_object_escape(rows,columns,col_delim=",",record_delim="\n",csv_schema=""):
        result = ""
        if len(csv_schema)>0 :
            result = csv_schema + record_delim

        for _ in range(rows):
            row = ""
            for _ in range(columns):
                if random.randint(0,9) == 5:
                    row = row + "{}{}".format(''.join("_ar") ,col_delim)
                else:
                    row = row + "{}{}".format(''.join("aeio_")  ,col_delim)
                
            result += row + record_delim

        return result

def create_random_csv_object_null(rows,columns,col_delim=",",record_delim="\n",csv_schema=""):
        result = ""
        if len(csv_schema)>0 :
            result = csv_schema + record_delim

        for _ in range(rows):
            row = ""
            for _ in range(columns):
                if random.randint(0,5) == 2:
                    row = row + "{}{}".format(''.join("") ,col_delim)
                else:
                    row = row + "{}{}".format(''.join("abc") ,col_delim)
                
            result += row + record_delim

        return result

def upload_csv_object(bucket_name,new_key,obj):

        client = get_client()
        client.create_bucket(Bucket=bucket_name)
        client.put_object(Bucket=bucket_name, Key=new_key, Body=obj)

        # validate uploaded object
        #c2 = get_client()
        #response = c2.get_object(Bucket=bucket_name, Key=new_key)
        #eq(response['Body'].read().decode('utf-8'), obj, 's3select error[ downloaded object not equal to uploaded objecy')

def getobj_range_req(bucket_name,new_key,bytes_range):
        # return requested bytes range
        c2 = get_client()
        response = c2.get_object(Bucket=bucket_name, Key=new_key, Range=bytes_range)
        return response['Body'].read().decode('utf-8').strip()
        #return response['Body'].read().strip()

def run_s3select(bucket,key,query,column_delim=",",row_delim="\n",quot_char='"',esc_char='\\',csv_header_info="NONE", progress = False):

    s3 = get_client()
    result = ""
    try:
        r = s3.select_object_content(
        Bucket=bucket,
        Key=key,
        ExpressionType='SQL',
        InputSerialization = {"CSV": {"RecordDelimiter" : row_delim, "FieldDelimiter" : column_delim,"QuoteEscapeCharacter": esc_char, "QuoteCharacter": quot_char, "FileHeaderInfo": csv_header_info}, "CompressionType": "NONE"},
        OutputSerialization = {"CSV": {}},
        Expression=query,
        RequestProgress = {"Enabled": progress})

    except ClientError as c:
        result += str(c)
        return result

    if progress == False:
        for event in r['Payload']:
            if 'Records' in event:
                records = event['Records']['Payload'].decode('utf-8')
                result += records
    else:
        result = []
        for event in r['Payload']:
            if 'Records' in event:
                records = event['Records']
                result.append(records.copy())
            if 'Progress' in event:
                progress = event['Progress']
                result.append(progress.copy())
            if 'Stats' in event:
                stats = event['Stats']
                result.append(stats.copy())
            if 'End' in event:
                end = event['End']
                result.append(end.copy())
    return result
def run_s3select_output(bucket,key,query, quot_field, op_column_delim = ",", op_row_delim = "\n",  column_delim=",", op_quot_char = '"', op_esc_char = '\\', row_delim="\n",quot_char='"',esc_char='\\',csv_header_info="NONE"):

    s3 = get_client()

    r = s3.select_object_content(
        Bucket=bucket,
        Key=key,
        ExpressionType='SQL',
        InputSerialization = {"CSV": {"RecordDelimiter" : row_delim, "FieldDelimiter" : column_delim,"QuoteEscapeCharacter": esc_char, "QuoteCharacter": quot_char, "FileHeaderInfo": csv_header_info}, "CompressionType": "NONE"},
        OutputSerialization = {"CSV": {"RecordDelimiter" : op_row_delim, "FieldDelimiter" : op_column_delim, "QuoteCharacter" : op_quot_char, "QuoteEscapeCharacter" : op_esc_char, "QuoteFields" : quot_field}},
        Expression=query,)
    
    result = ""
    for event in r['Payload']:
        if 'Records' in event:
            records = event['Records']['Payload'].decode('utf-8')
            result += records
    
    return result

def remove_xml_tags_from_result(obj):
    result = ""
    for rec in obj.split("\n"):
        if(rec.find("Payload")>0 or rec.find("Records")>0):
            continue
        result += rec + "\n" # remove by split

    result_strip= result.strip()
    x = bool(re.search("^failure.*$", result_strip))
    if x:
        logging.info(result)
    nose.tools.assert_equal(x, False)

    return result

def create_list_of_int(column_pos,obj,field_split=",",row_split="\n"):
    
    list_of_int = [] 
    for rec in obj.split(row_split):
        col_num = 1
        if ( len(rec) == 0):
            continue
        for col in rec.split(field_split):
            if (col_num == column_pos):
                list_of_int.append(int(col))
            col_num+=1

    return list_of_int

@attr('s3select')
def test_count_operation():
    csv_obj_name = get_random_string()
    bucket_name = "test"
    num_of_rows = 1234
    obj_to_load = create_random_csv_object(num_of_rows,10)
    upload_csv_object(bucket_name,csv_obj_name,obj_to_load)
    res = remove_xml_tags_from_result( run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object;") ).replace(",","")

    s3select_assert_result( num_of_rows, int( res ))

@attr('s3select')
def test_column_sum_min_max():
    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)
    
    csv_obj_name_2 = get_random_string()
    bucket_name_2 = "testbuck2"
    upload_csv_object(bucket_name_2,csv_obj_name_2,csv_obj)
    
    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select min(int(_1)) from s3object;")  ).replace(",","")
    list_int = create_list_of_int( 1 , csv_obj )
    res_target = min( list_int )

    s3select_assert_result( int(res_s3select), int(res_target))

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select min(int(_4)) from s3object;")  ).replace(",","")
    list_int = create_list_of_int( 4 , csv_obj )
    res_target = min( list_int )

    s3select_assert_result( int(res_s3select), int(res_target))

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select avg(int(_6)) from s3object;")  ).replace(",","")
    list_int = create_list_of_int( 6 , csv_obj )
    res_target = float(sum(list_int ))/10000

    s3select_assert_result( float(res_s3select), float(res_target))
    
    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select max(int(_4)) from s3object;")  ).replace(",","")
    list_int = create_list_of_int( 4 , csv_obj )
    res_target = max( list_int )

    s3select_assert_result( int(res_s3select), int(res_target))
    
    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select max(int(_7)) from s3object;")  ).replace(",","")
    list_int = create_list_of_int( 7 , csv_obj )
    res_target = max( list_int )

    s3select_assert_result( int(res_s3select), int(res_target))
    
    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select sum(int(_4)) from s3object;")  ).replace(",","")
    list_int = create_list_of_int( 4 , csv_obj )
    res_target = sum( list_int )

    s3select_assert_result( int(res_s3select), int(res_target))
    
    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select sum(int(_7)) from s3object;")  ).replace(",","")
    list_int = create_list_of_int( 7 , csv_obj )
    res_target = sum( list_int )

    s3select_assert_result(  int(res_s3select) , int(res_target) )

    # the following queries, validates on *random* input an *accurate* relation between condition result,sum operation and count operation.
    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name_2,csv_obj_name_2,"select count(0),sum(int(_1)),sum(int(_2)) from s3object where (int(_1)-int(_2)) = 2;" ) )
    count,sum1,sum2 = res_s3select.split(",")

    s3select_assert_result( int(count)*2 , int(sum1)-int(sum2 ) )

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0),sum(int(_1)),sum(int(_2)) from s3object where (int(_1)-int(_2)) = 4;" ) ) 
    count,sum1,sum2 = res_s3select.split(",")

    s3select_assert_result( int(count)*4 , int(sum1)-int(sum2) )

@attr('s3select')
def test_nullif_expressions():

    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_nullif = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object where nullif(_1,_2) is null ;")  ).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object where _1 = _2  ;")  ).replace("\n","")

    s3select_assert_result( res_s3select_nullif, res_s3select)

    res_s3select_nullif = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select (nullif(_1,_2) is null) from s3object ;")  ).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select (_1 = _2) from s3object  ;")  ).replace("\n","")

    s3select_assert_result( res_s3select_nullif, res_s3select)

    res_s3select_nullif = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object where not nullif(_1,_2) is null ;")  ).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object where _1 != _2  ;")  ).replace("\n","")

    s3select_assert_result( res_s3select_nullif, res_s3select)

    res_s3select_nullif = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select (nullif(_1,_2) is not null) from s3object ;")  ).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select (_1 != _2) from s3object  ;")  ).replace("\n","")

    s3select_assert_result( res_s3select_nullif, res_s3select)

    res_s3select_nullif = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object where  nullif(_1,_2) = _1 ;")  ).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object where _1 != _2  ;")  ).replace("\n","")

    s3select_assert_result( res_s3select_nullif, res_s3select)

    csv_obj = create_random_csv_object_null(10000,10)

    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_nullif = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(*) from s3object where nullif(_1,null) is null;")  ).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(*) from s3object where _1 is null;")  ).replace("\n","")

    s3select_assert_result( res_s3select_nullif, res_s3select)

    res_s3select_nullif = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select (nullif(_1,null) is null) from s3object;")  ).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select (_1 is null) from s3object;")  ).replace("\n","")

    s3select_assert_result( res_s3select_nullif, res_s3select)

@attr('s3select')
def test_nulliftrue_expressions():

    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_nullif = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object where (nullif(_1,_2) is null) = true ;")  ).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object where _1 = _2  ;")  ).replace("\n","")

    s3select_assert_result( res_s3select_nullif, res_s3select)

    res_s3select_nullif = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object where not (nullif(_1,_2) is null) = true ;")  ).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object where _1 != _2  ;")  ).replace("\n","")

    s3select_assert_result( res_s3select_nullif, res_s3select)

    res_s3select_nullif = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object where (nullif(_1,_2) = _1 = true) ;")  ).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object where _1 != _2  ;")  ).replace("\n","")

    s3select_assert_result( res_s3select_nullif, res_s3select)

@attr('s3select')
def test_is_not_null_expressions():

    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_null = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(*) from s3object where nullif(_1,_2) is not null ;")  ).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(*) from s3object where _1 != _2  ;")  ).replace("\n","")

    s3select_assert_result( res_s3select_null, res_s3select)

    res_s3select_null = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(*) from s3object where (nullif(_1,_1) and _1 = _2) is not null ;")  ).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select count(*) from s3object where _1 != _2  ;")  ).replace("\n","")

    s3select_assert_result( res_s3select_null, res_s3select)

@attr('s3select')
def test_lowerupper_expressions():

    csv_obj = create_random_csv_object(1,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select lower("AB12cd$$") from s3object ;')  ).replace("\n","")

    s3select_assert_result( res_s3select, "ab12cd$$")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select upper("ab12CD$$") from s3object ;')  ).replace("\n","")

    s3select_assert_result( res_s3select, "AB12CD$$")

@attr('s3select')
def test_in_expressions():

    # purpose of test: engine is process correctly several projections containing aggregation-functions
    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where int(_1) in(1);')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where int(_1) = 1;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (int(_1) in(1)) from s3object;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (int(_1) = 1) from s3object;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where int(_1) in(1,0);')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where int(_1) = 1 or int(_1) = 0;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (int(_1) in(1,0)) from s3object;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (int(_1) = 1 or int(_1) = 0) from s3object;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_2) from s3object where int(_2) in(1,0,2);')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_2) from s3object where int(_2) = 1 or int(_2) = 0 or int(_2) = 2;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (int(_2) in(1,0,2)) from s3object;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (int(_2) = 1 or int(_2) = 0 or int(_2) = 2) from s3object;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_2) from s3object where int(_2)*2 in(int(_3)*2,int(_4)*3,int(_5)*5);')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_2) from s3object where int(_2)*2 = int(_3)*2 or int(_2)*2 = int(_4)*3 or int(_2)*2 = int(_5)*5;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (int(_2)*2 in(int(_3)*2,int(_4)*3,int(_5)*5)) from s3object;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (int(_2)*2 = int(_3)*2 or int(_2)*2 = int(_4)*3 or int(_2)*2 = int(_5)*5) from s3object;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where character_length(_1) = 2 and substring(_1,2,1) in ("3");')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where _1 like "_3";')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (character_length(_1) = 2 and substring(_1,2,1) in ("3")) from s3object;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (_1 like "_3") from s3object;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

@attr('s3select')
def test_true_false_in_expressions():

    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where (int(_1) in(1)) = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where int(_1) = 1;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where (int(_1) in(1,0)) = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where int(_1) = 1 or int(_1) = 0;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_2) from s3object where (int(_2) in(1,0,2)) = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_2) from s3object where int(_2) = 1 or int(_2) = 0 or int(_2) = 2;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_2) from s3object where (int(_2)*2 in(int(_3)*2,int(_4)*3,int(_5)*5)) = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_2) from s3object where int(_2)*2 = int(_3)*2 or int(_2)*2 = int(_4)*3 or int(_2)*2 = int(_5)*5;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where (character_length(_1) = 2) = true and (substring(_1,2,1) in ("3")) = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where _1 like "_3";')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )

    res_s3select_in = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (int(_1) in (1,2,0)) as a1 from s3object where a1 = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select \"true\"from s3object where (int(_1) in (1,0,2)) ;')).replace("\n","")

    s3select_assert_result( res_s3select_in, res_s3select )  

@attr('s3select')
def test_like_expressions():

    csv_obj = create_random_csv_object_string(1000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where _1 like "%aeio%";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,11,4) = "aeio" ;')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select  (_1 like "%aeio%") from s3object ;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select (substring(_1,11,4) = "aeio") from s3object ;')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where _1 like "cbcd%";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,1,4) = "cbcd";')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from stdin where _1 like "%aeio%" like;')).replace("\n","")

    find_like = res_s3select_like.find("s3select-Syntax-Error")

    assert int(find_like) >= 0

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (_1 like "cbcd%") from s3object;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select (substring(_1,1,4) = "cbcd") from s3object;')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where _3 like "%y[y-z]";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_3,char_length(_3),1) between "y" and "z" and substring(_3,char_length(_3)-1,1) = "y";')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (_3 like "%y[y-z]") from s3object;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select (substring(_3,char_length(_3),1) between "y" and "z" and substring(_3,char_length(_3)-1,1) = "y") from s3object;')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where _2 like "%yz";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_2,char_length(_2),1) = "z" and substring(_2,char_length(_2)-1,1) = "y";')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (_2 like "%yz") from s3object;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select (substring(_2,char_length(_2),1) = "z" and substring(_2,char_length(_2)-1,1) = "y") from s3object;')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where _3 like "c%z";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_3,char_length(_3),1) = "z" and substring(_3,1,1) = "c";')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (_3 like "c%z") from s3object;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select (substring(_3,char_length(_3),1) = "z" and substring(_3,1,1) = "c") from s3object;')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where _2 like "%xy_";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_2,char_length(_2)-1,1) = "y" and substring(_2,char_length(_2)-2,1) = "x";')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select (_2 like "%xy_") from s3object;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select (substring(_2,char_length(_2)-1,1) = "y" and substring(_2,char_length(_2)-2,1) = "x") from s3object;')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

@attr('s3select')
def test_truefalselike_expressions():

    csv_obj = create_random_csv_object_string(1000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where (_1 like "%aeio%") = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,11,4) = "aeio" ;')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where (_1 like "cbcd%") = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,1,4) = "cbcd";')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where (_3 like "%y[y-z]") = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where (substring(_3,char_length(_3),1) between "y" and "z") = true and (substring(_3,char_length(_3)-1,1) = "y") = true;')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where (_2 like "%yz") = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where (substring(_2,char_length(_2),1) = "z") = true and (substring(_2,char_length(_2)-1,1) = "y") = true;')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where (_3 like "c%z") = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where (substring(_3,char_length(_3),1) = "z") = true and (substring(_3,1,1) = "c") = true;')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

    res_s3select_like = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where (_2 like "%xy_") = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where (substring(_2,char_length(_2)-1,1) = "y") = true and (substring(_2,char_length(_2)-2,1) = "x") = true;')).replace("\n","")

    s3select_assert_result( res_s3select_like, res_s3select )

@attr('s3select')
def test_complex_expressions():

    # purpose of test: engine is process correctly several projections containing aggregation-functions 
    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select min(int(_1)),max(int(_2)),min(int(_3))+1 from s3object;")).replace("\n","")

    min_1 = min ( create_list_of_int( 1 , csv_obj ) )
    max_2 = max ( create_list_of_int( 2 , csv_obj ) )
    min_3 = min ( create_list_of_int( 3 , csv_obj ) ) + 1

    __res = "{},{},{}".format(min_1,max_2,min_3)
    
    # assert is according to radom-csv function 
    s3select_assert_result( res_s3select, __res )

    # purpose of test that all where conditions create the same group of values, thus same result
    res_s3select_substring = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select min(int(_2)),max(int(_2)) from s3object where substring(_2,1,1) = "1" and char_length(_2) = 3;')).replace("\n","")

    res_s3select_between_numbers = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select min(int(_2)),max(int(_2)) from s3object where int(_2)>=100 and int(_2)<200;')).replace("\n","")

    res_s3select_eq_modolu = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select min(int(_2)),max(int(_2)) from s3object where int(_2)/100 = 1 and character_length(_2) = 3;')).replace("\n","")

    s3select_assert_result( res_s3select_substring, res_s3select_between_numbers)

    s3select_assert_result( res_s3select_between_numbers, res_s3select_eq_modolu)
    
@attr('s3select')
def test_alias():

    # purpose: test is comparing result of exactly the same queries , one with alias the other without.
    # this test is setting alias on 3 projections, the third projection is using other projection alias, also the where clause is using aliases
    # the test validate that where-clause and projections are executing aliases correctly, bare in mind that each alias has its own cache,
    # and that cache need to be invalidate per new row. 

    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_alias = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select int(_1) as a1, int(_2) as a2 , (a1+a2) as a3 from s3object where a3>100 and a3<300;")  ).replace(",","")

    res_s3select_no_alias = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select int(_1),int(_2),int(_1)+int(_2) from s3object where (int(_1)+int(_2))>100 and (int(_1)+int(_2))<300;")  ).replace(",","")

    s3select_assert_result( res_s3select_alias, res_s3select_no_alias)


@attr('s3select')
def test_alias_cyclic_refernce():

    number_of_rows = 10000
    
    # purpose of test is to validate the s3select-engine is able to detect a cyclic reference to alias.
    csv_obj = create_random_csv_object(number_of_rows,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_alias = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select int(_1) as a1,int(_2) as a2, a1+a4 as a3, a5+a1 as a4, int(_3)+a3 as a5 from s3object;")  )

    find_res = res_s3select_alias.find("number of calls exceed maximum size, probably a cyclic reference to alias")
    
    assert int(find_res) >= 0 

@attr('s3select')
def test_datetime():

    # purpose of test is to validate date-time functionality is correct,
    # by creating same groups with different functions (nested-calls) ,which later produce the same result 

    csv_obj = create_csv_object_for_datetime(10000,1)

    csv_obj_name = get_random_string()
    bucket_name = "test"

    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_date_time = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(0) from  s3object where extract(year from to_timestamp(_1)) > 1950 and extract(year from to_timestamp(_1)) < 1960;')  )

    res_s3select_substring = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(0) from  s3object where int(substring(_1,1,4))>1950 and int(substring(_1,1,4))<1960;')  )

    s3select_assert_result( res_s3select_date_time, res_s3select_substring)

    res_s3select_date_time_to_string = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select cast(to_string(to_timestamp(_1), \'x\') as int) from  s3object;')  )

    res_s3select_date_time_extract = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select extract(timezone_hour from to_timestamp(_1)) from  s3object;')  )

    s3select_assert_result( res_s3select_date_time_to_string, res_s3select_date_time_extract )

    res_s3select_date_time_to_timestamp = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select extract(month from to_timestamp(_1)) from s3object where extract(month from to_timestamp(_1)) = 5;')  )

    res_s3select_substring = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select cast(substring(_1, 5, 2) as int) from s3object where _1 like \'____05%\';')  )

    s3select_assert_result( res_s3select_date_time_to_timestamp, res_s3select_substring)

@attr('s3select')
def test_true_false_datetime():

    # purpose of test is to validate date-time functionality is correct,
    # by creating same groups with different functions (nested-calls) ,which later produce the same result 

    csv_obj = create_csv_object_for_datetime(10000,1)

    csv_obj_name = get_random_string()
    bucket_name = "test"

    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_date_time = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(0) from  s3object where (extract(year from to_timestamp(_1)) > 1950) = true and (extract(year from to_timestamp(_1)) < 1960) = true;')  )

    res_s3select_substring = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(0) from  s3object where int(substring(_1,1,4))>1950 and int(substring(_1,1,4))<1960;')  )

    s3select_assert_result( res_s3select_date_time, res_s3select_substring)

    res_s3select_date_time = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(0) from  s3object where  (date_diff(month,to_timestamp(_1),date_add(month,2,to_timestamp(_1)) ) = 2) = true;')  )

    res_s3select_count = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(0) from  s3object;')  )

    s3select_assert_result( res_s3select_date_time, res_s3select_count)

    res_s3select_date_time = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(0) from  s3object where (date_diff(year,to_timestamp(_1),date_add(day, 366 ,to_timestamp(_1))) = 1) = true ;')  )

    s3select_assert_result( res_s3select_date_time, res_s3select_count)

    # validate that utcnow is integrate correctly with other date-time functions 
    res_s3select_date_time_utcnow = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(0) from  s3object where (date_diff(hour,utcnow(),date_add(day,1,utcnow())) = 24) = true ;')  )

    s3select_assert_result( res_s3select_date_time_utcnow, res_s3select_count)

@attr('s3select')
def test_csv_parser():

    # purpuse: test default csv values(, \n " \ ), return value may contain meta-char 
    # NOTE: should note that default meta-char for s3select are also for python, thus for one example double \ is mandatory

    csv_obj = ',first,,,second,third="c31,c32,c33",forth="1,2,3,4",fifth="my_string=\\"any_value\\" , my_other_string=\\"aaaa,bbb\\" ",' + "\n"
    csv_obj_name = get_random_string()
    bucket_name = "test"

    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    # return value contain comma{,}
    res_s3select_alias = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select _6 from s3object;")  ).replace("\n","")
    s3select_assert_result( res_s3select_alias, 'third="c31,c32,c33"')

    # return value contain comma{,}
    res_s3select_alias = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select _7 from s3object;")  ).replace("\n","")
    s3select_assert_result( res_s3select_alias, 'forth="1,2,3,4"')

    # return value contain comma{,}{"}, escape-rule{\} by-pass quote{"} , the escape{\} is removed.
    res_s3select_alias = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select _8 from s3object;")  ).replace("\n","")
    s3select_assert_result( res_s3select_alias, 'fifth="my_string="any_value" , my_other_string="aaaa,bbb" "')

    # return NULL as first token
    res_s3select_alias = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select _1 from s3object;")  ).replace("\n","")
    s3select_assert_result( res_s3select_alias, 'null')

    # return NULL in the middle of line
    res_s3select_alias = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select _3 from s3object;")  ).replace("\n","")
    s3select_assert_result( res_s3select_alias, 'null')

    # return NULL in the middle of line (successive)
    res_s3select_alias = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select _4 from s3object;")  ).replace("\n","")
    s3select_assert_result( res_s3select_alias, 'null')

    # return NULL at the end line
    res_s3select_alias = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select _9 from s3object;")  ).replace("\n","")
    s3select_assert_result( res_s3select_alias, 'null')

@attr('s3select')
def test_csv_definition():

    number_of_rows = 10000

    #create object with pipe-sign as field separator and tab as row delimiter.
    csv_obj = create_random_csv_object(number_of_rows,10,"|","\t")

    csv_obj_name = get_random_string()
    bucket_name = "test"

    upload_csv_object(bucket_name,csv_obj_name,csv_obj)
   
    # purpose of tests is to parse correctly input with different csv defintions  
    res = remove_xml_tags_from_result( run_s3select(bucket_name,csv_obj_name,"select count(0) from s3object;","|","\t") ).replace(",","")

    s3select_assert_result( number_of_rows, int(res))
    
    # assert is according to radom-csv function 
    # purpose of test is validate that tokens are processed correctly
    res_s3select = remove_xml_tags_from_result( run_s3select(bucket_name,csv_obj_name,"select min(int(_1)),max(int(_2)),min(int(_3))+1 from s3object;","|","\t") ).replace("\n","")

    min_1 = min ( create_list_of_int( 1 , csv_obj , "|","\t") )
    max_2 = max ( create_list_of_int( 2 , csv_obj , "|","\t") )
    min_3 = min ( create_list_of_int( 3 , csv_obj , "|","\t") ) + 1

    __res = "{},{},{}".format(min_1,max_2,min_3)
    s3select_assert_result( res_s3select, __res )


@attr('s3select')
def test_schema_definition():

    number_of_rows = 10000

    # purpose of test is to validate functionality using csv header info
    csv_obj = create_random_csv_object(number_of_rows,10,csv_schema="c1,c2,c3,c4,c5,c6,c7,c8,c9,c10")

    csv_obj_name = get_random_string()
    bucket_name = "test"

    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    # ignoring the schema on first line and retrieve using generic column number
    res_ignore = remove_xml_tags_from_result( run_s3select(bucket_name,csv_obj_name,"select _1,_3 from s3object;",csv_header_info="IGNORE") ).replace("\n","")

    # using the scheme on first line, query is using the attach schema
    res_use = remove_xml_tags_from_result( run_s3select(bucket_name,csv_obj_name,"select c1,c3 from s3object;",csv_header_info="USE") ).replace("\n","")
    
    # result of both queries should be the same
    s3select_assert_result( res_ignore, res_use)

    # using column-name not exist in schema
    res_multiple_defintion = remove_xml_tags_from_result( run_s3select(bucket_name,csv_obj_name,"select c1,c10,int(c11) from s3object;",csv_header_info="USE") ).replace("\n","")

    assert ((res_multiple_defintion.find("alias {c11} or column not exist in schema")) >= 0)

    #find_processing_error = res_multiple_defintion.find("s3select-ProcessingTime-Error")
    assert ((res_multiple_defintion.find("s3select-ProcessingTime-Error")) >= 0)

    # alias-name is identical to column-name
    res_multiple_defintion = remove_xml_tags_from_result( run_s3select(bucket_name,csv_obj_name,"select int(c1)+int(c2) as c4,c4 from s3object;",csv_header_info="USE") ).replace("\n","")

    assert ((res_multiple_defintion.find("multiple definition of column {c4} as schema-column and alias"))  >= 0)

@attr('s3select')
def test_when_then_else_expressions():

    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select case when cast(_1 as int)>100 and cast(_1 as int)<200 then "(100-200)" when cast(_1 as int)>200 and cast(_1 as int)<300 then "(200-300)" else "NONE" end from s3object;')  ).replace("\n","")

    count1 = res_s3select.count("(100-200)")  

    count2 = res_s3select.count("(200-300)") 

    count3 = res_s3select.count("NONE")

    res = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where  cast(_1 as int)>100 and cast(_1 as int)<200  ;')  ).replace("\n","")

    res1 = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where  cast(_1 as int)>200 and cast(_1 as int)<300  ;')  ).replace("\n","")
    
    res2 = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where  cast(_1 as int)<=100 or cast(_1 as int)>=300 or cast(_1 as int)=200  ;')  ).replace("\n","")

    s3select_assert_result( str(count1) , res)

    s3select_assert_result( str(count2) , res1)

    s3select_assert_result( str(count3) , res2)

@attr('s3select')
def test_coalesce_expressions():

    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where char_length(_3)>2 and char_length(_4)>2 and cast(substring(_3,1,2) as int) = cast(substring(_4,1,2) as int);')  ).replace("\n","")  

    res_null = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where cast(_3 as int)>99 and cast(_4 as int)>99 and coalesce(nullif(cast(substring(_3,1,2) as int),cast(substring(_4,1,2) as int)),7) = 7;' ) ).replace("\n","") 

    s3select_assert_result( res_s3select, res_null)

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select coalesce(nullif(_5,_5),nullif(_1,_1),_2) from s3object;')  ).replace("\n","") 

    res_coalesce = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select coalesce(_2) from s3object;')  ).replace("\n","")   

    s3select_assert_result( res_s3select, res_coalesce)


@attr('s3select')
def test_cast_expressions():

    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where cast(_3 as int)>999;')  ).replace("\n","")  

    res = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where char_length(_3)>3;')  ).replace("\n","") 

    s3select_assert_result( res_s3select, res)

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where cast(_3 as int)>99 and cast(_3 as int)<1000;')  ).replace("\n","")  

    res = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where char_length(_3)=3;')  ).replace("\n","") 

    s3select_assert_result( res_s3select, res)

@attr('s3select')
def test_version():

    return
    number_of_rows = 1

    # purpose of test is to validate functionality using csv header info
    csv_obj = create_random_csv_object(number_of_rows,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"

    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_version = remove_xml_tags_from_result( run_s3select(bucket_name,csv_obj_name,"select version() from s3object;") ).replace("\n","")

    s3select_assert_result( res_version, "41.a," )

@attr('s3select')
def test_trim_expressions():

    csv_obj = create_random_csv_object_trim(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_trim = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where trim(_1) = "aeiou";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1 from 4 for 5) = "aeiou";')).replace("\n","")

    s3select_assert_result( res_s3select_trim, res_s3select )

    res_s3select_trim = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where trim(both from _1) = "aeiou";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,4,5) = "aeiou";')).replace("\n","")

    s3select_assert_result( res_s3select_trim, res_s3select )

    res_s3select_trim = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where trim(trailing from _1) = "   aeiou";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,4,5) = "aeiou";')).replace("\n","")

    s3select_assert_result( res_s3select_trim, res_s3select )

    res_s3select_trim = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where trim(leading from _1) = "aeiou    ";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,4,5) = "aeiou";')).replace("\n","")

    s3select_assert_result( res_s3select_trim, res_s3select )

    res_s3select_trim = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where trim(trim(leading from _1)) = "aeiou";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,4,5) = "aeiou";')).replace("\n","")

    s3select_assert_result( res_s3select_trim, res_s3select )

@attr('s3select')
def test_truefalse_trim_expressions():

    csv_obj = create_random_csv_object_trim(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_trim = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where trim(_1) = "aeiou" = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1 from 4 for 5) = "aeiou";')).replace("\n","")

    s3select_assert_result( res_s3select_trim, res_s3select )

    res_s3select_trim = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where trim(both from _1) = "aeiou" = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,4,5) = "aeiou";')).replace("\n","")

    s3select_assert_result( res_s3select_trim, res_s3select )

    res_s3select_trim = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where trim(trailing from _1) = "   aeiou" = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,4,5) = "aeiou";')).replace("\n","")

    s3select_assert_result( res_s3select_trim, res_s3select )

    res_s3select_trim = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where trim(leading from _1) = "aeiou    " = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,4,5) = "aeiou";')).replace("\n","")

    s3select_assert_result( res_s3select_trim, res_s3select )

    res_s3select_trim = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where trim(trim(leading from _1)) = "aeiou" = true;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,4,5) = "aeiou";')).replace("\n","")

    s3select_assert_result( res_s3select_trim, res_s3select )

@attr('s3select')
def test_escape_expressions():

    csv_obj = create_random_csv_object_escape(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_escape = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where _1 like "%_ar" escape "%";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,char_length(_1),1) = "r" and substring(_1,char_length(_1)-1,1) = "a" and substring(_1,char_length(_1)-2,1) = "_";')).replace("\n","")

    s3select_assert_result( res_s3select_escape, res_s3select )

    res_s3select_escape = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where _1 like "%aeio$_" escape "$";')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where substring(_1,1,5) = "aeio_";')).replace("\n","")

    s3select_assert_result( res_s3select_escape, res_s3select )

@attr('s3select')
def test_case_value_expressions():

    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_case = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select case cast(_1 as int) when cast(_2 as int) then "case_1_1" else "case_2_2" end from s3object;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select case when cast(_1 as int) = cast(_2 as int) then "case_1_1" else "case_2_2" end from s3object;')).replace("\n","")

    s3select_assert_result( res_s3select_case, res_s3select )

@attr('s3select')
def test_bool_cast_expressions():

    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_cast = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select count(*) from s3object where cast(int(_1) as bool) = true ;')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select count(*) from s3object where cast(_1 as int) != 0 ;')).replace("\n","")

    s3select_assert_result( res_s3select_cast, res_s3select )

@attr('s3select')
def test_progress_expressions():

    csv_obj = create_random_csv_object(1000000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    obj_size = len(csv_obj.encode('utf-8'))

    res_s3select_response = run_s3select(bucket_name,csv_obj_name,"select sum(int(_1)) from s3object;",progress = True)
    records_payload_size = len(remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name, 'select sum(int(_1)) from s3object;')).replace("\n",""))

    total_response = len(res_s3select_response)
    
    # To do: Validate bytes processed after supporting compressed data
    s3select_assert_result(obj_size, res_s3select_response[total_response-3]['Details']['BytesScanned'])
    s3select_assert_result(records_payload_size, res_s3select_response[total_response-3]['Details']['BytesReturned'])

    # stats response payload validation
    s3select_assert_result(obj_size, res_s3select_response[total_response-2]['Details']['BytesScanned'])
    s3select_assert_result(records_payload_size, res_s3select_response[total_response-2]['Details']['BytesReturned'])

    # end response
    s3select_assert_result({}, res_s3select_response[total_response-1])

@attr('s3select')
def test_output_serial_expressions():
    return # TODO fix test

    csv_obj = create_random_csv_object(10000,10)

    csv_obj_name = get_random_string()
    bucket_name = "test"
    upload_csv_object(bucket_name,csv_obj_name,csv_obj)

    res_s3select_1 = remove_xml_tags_from_result(  run_s3select_output(bucket_name,csv_obj_name,"select _1, _2 from s3object where nullif(_1,_2) is null ;", "ALWAYS")  ).replace("\n",",")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,"select _1, _2 from s3object where _1 = _2 ;")  ).replace("\n",",")

    res_s3select_list = res_s3select.split(',')
    res_s3select_final = (','.join('"' + item + '"' for item in res_s3select_list)).replace('""','') # remove empty result(first,last)

    s3select_assert_result( res_s3select_1, res_s3select_final)

    res_s3select_in = remove_xml_tags_from_result(  run_s3select_output(bucket_name,csv_obj_name,'select int(_1) from s3object where (int(_1) in(int(_2)));', "ASNEEDED", '$', '#')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where int(_1) = int(_2);')).replace("\n","#")
    res_s3select = res_s3select[1:len(res_s3select)] # remove first redundant
    res_s3select_final = res_s3select[0:len(res_s3select)-1] # remove last redundant

    s3select_assert_result( res_s3select_in, res_s3select_final )

    res_s3select_quot = remove_xml_tags_from_result(  run_s3select_output(bucket_name,csv_obj_name,'select int(_1) from s3object where (int(_1) in(int(_2)));', "ALWAYS", '$', '#')).replace("\n","")

    res_s3select = remove_xml_tags_from_result(  run_s3select(bucket_name,csv_obj_name,'select int(_1) from s3object where int(_1) = int(_2);')).replace("\n","#")
    res_s3select = res_s3select[1:len(res_s3select)] # remove first redundant
    res_s3select = res_s3select[0:len(res_s3select)-1] # remove last redundant

    res_s3select_list = res_s3select.split('#')
    res_s3select_final = ('#'.join('"' + item + '"' for item in res_s3select_list)).replace('""','')
    
    s3select_assert_result( res_s3select_quot, res_s3select_final )

@attr('s3select')
def test_parquet():

    parquet_obj_name = "4col.parquet"
    bucket_name = "test"

    res_s3select = remove_xml_tags_from_result(  run_s3select("test",parquet_obj_name,"select count(0) from s3object where _1 > _2 and _2 > _3 and _3 > _4;")  ).replace(",","").replace("\n","")

    find_res = res_s3select.find("does not contain parquet magic")
    if (find_res > 0):
        raise nose.SkipTest("parquet magic is missing. skipping this test")
        return 

    s3select_assert_result( 46  , int( res_s3select ))

